---
- name: Collect only selected facts
  ansible.builtin.setup:
    filter:
      - ansible_hostname
      - ansible_os_family

- name: Get Computer Info
  community.windows.win_domain_computer_info:
    identity: "{{ ansible_hostname }}"
  register: test1
  failed_when: test1 is changed

- name: Get Computer Info with Properties
  community.windows.win_domain_computer_info:
    identity: "{{ ansible_hostname }}"
    properties:
      - name
      - samaccountname
      - dnshostname
  register: test2
  failed_when: test2 is changed

- name: Search for non-existent computer
  community.windows.win_domain_computer_info:
    identity: "NonExistentComputer"
  register: test3
  failed_when: test3.exists

- name: test with filter
  community.windows.win_domain_computer_info:
    filter: "Name -like 'ansible*'"
    properties:
      - DistinguishedName
  register: test4
  failed_when: not test4.exists

- name: test with ldap_filter
  community.windows.win_domain_computer_info:
    ldap_filter: "(name=*ansible*)"
    properties:
      - DNSHostName
  register: test5
  failed_when: not test5.exists
    
- name: Validate Assertions
  assert:
    that:
      - test1.computers[0].SamAccountName == "ANSIBLE-TESTER$"
      - test1.computers[0].PrimaryGroup == "CN=Domain Controllers,CN=Users,DC=ansible,DC=test"
      - test2.computers[0].DNSHostName == "ansible-tester.ansible.test"
      - test2.computers[0].Name == "ANSIBLE-TESTER"
      - not test3.exists
      - test4.computers[0].DistinguishedName == "CN=ANSIBLE-TESTER,OU=Domain Controllers,DC=ansible,DC=test"
      - test5.computers[0].DNSHostName == "ansible-tester.ansible.test"
